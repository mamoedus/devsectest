# PolyPrep

## Основная идея и функционал проекта

- Сервис по подготовке к экзаменам. 
- Конспекты от пользователей сервиса с возможностью загрузки на телефон и умные часы (с поддержкой аудио форматов). 
- Аутентификация по API вузов, возможность создавать собственные кейсы по предмету.
- Распознавание текста с картинок

Пользователи:
- Регистрация/авторизация/аутентификация, у каждого аккаунта пользователя есть аватарка, ник, описание, почта и пароль
- Данные манипуляции (кроме авторизации) проводятся на стороне Keycloak + должна быть капча

Конспекты:
- Создание/редактирование/удаление. 
- У каждого конспекта есть автор, название, хештеги, основной текст, могут быть прикрепленные аудио, pdf/word доки. Кроме того, есть реакции (лике/дизлике), комментарии.
- Можно создавать приватные конспекты и предоставлять к ним доступ по временным ссылкам (время настраивается пользователем, можно сделать бессрочную ссылку)

Комментарии к конспектам:
- Создание/удаление, также есть фильтрация по новым/старым.

Поиск: 
- Поиск по названию конспекта, тексту, хэштегам. Также есть отложенная отправка конспекта.

## Архитектура проекта

Микросервисы:
- Golang сервер - основной сервер для обработки большинства запросов
- Python сервер - вспомогательный сервер для преобразования аудио, фоток и тп в текст
- Nginx - внешний шлюз для маршрутизации всех запросов
- Keycloak - внешний сервер для аутентификации/авторизации

Фронтенд:
- Сайт статика React + TypeScript
- IOS-приложение 

БД:
- PostgreSQL - бд для хравнения всех конспектов, отзывов к ним, описаний юзеров
- Selectel S3 - объектное хранилище для картинок (фотки конспектов, аватарки пользователей) / аудиоконспектов

Описание работы микросервисов:

Все микросервисы и БД (кроме Selectel S3) должны работать в своих Docker-контейнерах, с помощью docker-compose.
В качестве внешнего шлюза выступает Nginx - он занимается отсылкой фронтенда, а также маршрутизирует REST-запросы от фронта к соответствующим нодам бэкенда

## Структура проекта на гите

| Директория / файл | Описание |
| ------------- | ------------- |
| /POLYPREP  | Корневая папка проекта  |
| /POLYPREP/docker-compose.yaml  | Docker-compose файл для развертывания контейнеров |
| /POLYPREP/docks  | Документация проекта |
| /POLYPREP/docks/api  | Open-API документация API |
| /POLYPREP/backend  | Папка для нод бэкэнда |
| /POLYPREP/backend/core  | Папка для основного сервера на Golang |
| /POLYPREP/backend/data-processing  | Папка для Python-сервера для работы с файлами/звуками/текстом |
| /POLYPREP/frontend  | Папка для фронтенда |

## Описание каждой ноды

### Nginx
Шлюз для маршрутизации всех запросов + хостит фронтенд.
Зачем нужен - чтобы все запросы извне шли по одному ip-шнику, а nginx по запросу сам разбирался какому микросервису его отсылать.
Для удобства будем использовать префиксы - то есть каждой группе эндпоинтов в микросервисе соответствует свой префикс.
Основной префикс для обращения к бэк-серверу - /api/v1

Примеры:
- Получения фронтенда - https://nginx-ip/ или https://nginx-ip/user
- Запрос к core-серверу - https://nginx-ip/api/v1/auth/check или https://nginx-ip/api/v1/note/put

### Golang сервер

Основной сервер для обработки большинства REST-запросов.

Список необходимых эндпоинтов (будет преобразован в open api позже):

<details>

<summary>Авторизация / регистрация</summary>

| Запрос | Эндпоинт | Описание |
| ------------- | ------------- | ------------- |
| **[GET]**   | /check  | Проверка аутентификации |
| **[GET]**   | /logout  | Выход из системы |
| **[GET]**   | /callback  | Получение респонса с Keycloak |

> Префикс эндпоинтов - **/auth**

</details>

<details>

<summary>Действия с аккаунтом</summary>

| Запрос | Эндпоинт | Описание |
| ------------- | ------------- | ------------- |
| **[POST]**   | /password/update  | Обновление пароля |
| **[POST]**   | /photo/update  | Обновление фото |
| **[POST]**   | /bio/update  | Обновление описания профиля |
| **[POST]**   | /name/update  | Обновление ника профиля |

> Префикс эндпоинтов - **/user**

</details>

<details>

<summary>Действия с пользовательскими сессиями</summary>

| Запрос | Эндпоинт | Описание |
| ------------- | ------------- | ------------- |
| **[GET]**   | /get  | Получение всех активных сессий |
| **[DELETE]**   | /delete  | Удаление активной сессии |
| **[DELETE]**   | /delete/all  | Удаление всех активных сессий |

> Префикс эндпоинтов - **/user/session**

</details>

<details>

<summary>Действия с конспектами</summary>

| Запрос | Эндпоинт | Описание |
| ------------- | ------------- | ------------- |
| **[GET]**   | /get  | Получение конспекта |
| **[GET]**   | /search  | Поиск конспектов |
| **[PUT]**   | /put  | Создание нового конспекта |
| **[PUT]**   | /put/scheduler  | Отложенное по времени создание нового конспекта |
| **[POST]**   | /update  | Обновление конспекта |
| **[POST]**   | /share  | Создание ограниченной по времени ссылки на просмотр приватного конспекта |
| **[DELETE]**   | /share/delete  | Удаление временной ссылки |
| **[DELETE]**   | /delete  | Удаление конспекта |

> Префикс эндпоинтов - **/note**

</details>

<details>

<summary>Действия с комментариями для конспекта</summary>

| Запрос | Эндпоинт | Описание |
| ------------- | ------------- | ------------- |
| **[GET]**   | /get  | Получение всех комментариев к конспекту |
| **[PUT]**   | /put  | Создание нового комментария |
| **[POST]**   | /update  | Редактирование комментария |
| **[DELETE]**   | /delete  | Удаление комментария |

> Префикс эндпоинтов - **/note/comments**

</details>

<details>

<summary>Действия с реакциями на конспект</summary>

| Запрос | Эндпоинт | Описание |
| ------------- | ------------- | ------------- |
| **[GET]**   | /get  | Получение реакций на конспект |
| **[PUT]**   | /put  | Поставить реакцию |
| **[POST]**   | /update  | Обновить реакицю |
| **[DELETE]**   | /delete  | Удаление реакцию |

> Префикс эндпоинтов - **/note/reactions**

</details>

### Python сервер

Предназначен для обработки картинок/аудио файлов и преобразования их в текст.

Стек: 
- FlaskAPI
- 

### Keycloak

Внешний сервер для аутентификации / авторизации
Основные фичи:

- Капча
- Регистрация / авторизация / аутентификация
- Управление сессиями юзеров
- 3 группы пользователей - admins, moderators, users
- Поддержка смены пароля
- Отключение пользователей администраторами
- Запрос необходимости сброса пароля пользователем при следующем входе
- TLS-сертификат доступа
- Мониторинг: уведомление о событиях
- Уведомления об инцидентах безопасности

### Фронтенд

Стек: 
- React (CreateReactApp)
- TypeScript

### PostgreSQL

База данных для хранения следующих элементов:

- Ники пользователей, описание
- Конспекты
- Комментарии к конспектам
- Реакции к конспектам
- Временные ссылки на приватные конспекты

### Selectel S3

S3 хранилище, предназначенное для хранения аудио файлов, картинок конспектов и аватарок профилей.


### Требования к CI/CD

- Автоматическая сборка проектов (GitHub Actions)	
- Настройка статического анализатора кода (напр. Bandit для Python)	
- Развертывание версий проектов (с отображением версии в интерфейсе)	
- Сканирование на безопасность (напр. AquaTrivy, Sonarqube)
- Мониторинг состояния системы (напр. ELK, Grafana Loki)	
- Дашборды с потреблением ресурсов сервера: ОЗУ, CPU, GPU, ПЗУ
- Дашборд со списком всех процессов, задействованных в проекте. Дашборд должен показывать насколько много ресурсов потребляет тот или иной процесс
